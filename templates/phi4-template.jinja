{% for message in messages %}
  {% if message.role == 'system' or tools %}
<|{{ message.role }}|>{{ message.content }}<|tool|>{% for t in tools %}{% set func = t["function"] %}{% set params = func["parameters"]["properties"] %}{ {{"name": func["name"], "description": func["description"], "parameters": params} | tojson(indent=0) }}{% endfor %}<|/tool|><|end|>
  {% else %}
<|{{ message.role }}|>{{ message.content }}<|end|>
  {% endif %}
{% endfor %}
{% if add_generation_prompt %}
<|assistant|>
{% else %}
{{ eos_token }}
{% endif %}
